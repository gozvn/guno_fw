<div class="bg-white rounded p-20 m-b-20">
    <div class="row">
        <div class="col-sm-8">
            <h4 class="page-title m-0 f-s-18 f-w-600">
                {{ 'order.common.title' | translate }}
            </h4>
        </div>
        <div class="col-sm-4 text-right">
            <div class="d-flex align-items-center justify-content-start justify-content-lg-end">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a class="text-body-color" [routerLink]="['/']">{{ 'labels.dashboard' | translate }}</a></li>
                    <li class="breadcrumb-item">
                        <i-tabler name="circle-filled" class="icon-8"></i-tabler>
                    </li>
                    <li class="breadcrumb-item active">
                        <span class="rounded-sm p-x-8 p-y-4 text-primary bg-light-primary f-s-12 f-w-500">
                            {{ 'order.common.title' | translate }}
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<mat-card class="cardWithShadow widget-container">
    <mat-tab-group
            [selectedIndex]="selectedTabIndex"
            (selectedTabChange)="onTabChange($event)"
            mat-stretch-tabs="false"
            animationDuration="0ms"
            class="theme-tab label-padding float-start order-tab-statues">
        <!-- all -->
        <mat-tab>
            <ng-template mat-tab-label>
                <span>{{ 'labels.all' | translate }}</span>&nbsp;<span class="badge ms-auto badge-custom-dark text-dark">{{ totalOrders | number }}</span>
            </ng-template>
            <ng-template *ngTemplateOutlet="listOrders"></ng-template>
        </mat-tab>
        <!-- / all -->
        <mat-tab *ngFor="let status of orderStatuses">
            <ng-template mat-tab-label>
                <span>{{ status.name }}</span>&nbsp;<span class="badge ms-auto badge-custom-dark text-dark">{{ status?.count ?? 0 | number }}</span>
            </ng-template>
            <ng-template *ngTemplateOutlet="listOrders"></ng-template>
        </mat-tab>
    </mat-tab-group>
</mat-card>

<ng-template #listOrders>
    <mat-card-content class="p-0 p-b-10">
        <mat-divider></mat-divider>
        <div class="p-t-0 p-b-20 p-r-10 p-l-10 d-lg-flex">
            <button mat-mini-fab color="primary m-t-24 m-r-10" (click)="openDialogCreateDelivery()" class="d-flex">
                <i class="iconify icon-20 d-flex" data-icon="solar:widget-add-linear"></i>
            </button>
            <mat-form-field class="theme-select m-r-10 d-flex m-t-20 input-height-46" appearance="outline" [style.width.px]="160">
                <mat-label>{{ 'labels.autoRefresh' | translate }}</mat-label>
                <mat-icon matPrefix class="m-r-0 p-r-0"><i-tabler name="refresh" class="icon-20 cursor-pointer"></i-tabler></mat-icon>
                <mat-select [value]="presetAutoRefresh" (selectionChange)="onSelectPresetAutoRefreshChange($event)">
                    <mat-option *ngFor="let preset of presetAutoRefreshs" [value]="preset">
                        <ng-container *ngIf="preset !== 'customize'">
                            {{ 'labels.autoRefresh' + preset | translate }}
                        </ng-container>
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field [style.width.px]="200" class="theme-select m-r-10 d-flex m-t-20 input-height-46" appearance="outline">
                <mat-label>{{ 'warehouse.common.keyword' | translate }}</mat-label>
                <input type="text"
                       placeholder="{{ 'warehouse.common.keywordPlaceholder' | translate }}"
                       matInput
                       (keyup.enter)="onInputOrderEnter($event)"
                       [(ngModel)]="keyword" />
            </mat-form-field>
            <mat-form-field class="theme-select m-r-10 d-flex m-t-20 input-height-46" appearance="outline" [style.width.px]="160">
                <mat-label>{{ 'warehouse.common.orderSource' | translate }}</mat-label>
                <mat-icon matPrefix class="m-r-0 p-r-0"><i-tabler name="social" class="icon-20 cursor-pointer"></i-tabler></mat-icon>
                <mat-select [value]="orderSource" (selectionChange)="onSelectPresetOrderSourceChange($event)">
                    <mat-option *ngFor="let preset of presetOrderSources" [value]="preset">
                        <ng-container *ngIf="preset !== 'customize'">
                            {{ 'warehouse.common.orderSources.' + preset | translate }}
                        </ng-container>
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="theme-select m-r-10 d-flex m-t-20 input-height-46" appearance="outline" [style.width.px]="200">
                <mat-label>{{ 'warehouse.common.orderStatus' | translate }}</mat-label>
                <mat-select [value]="orderStatus" multiple (selectionChange)="onOrderStatusChange($event)">
                    <mat-option *ngFor="let s of orderStatuses" [value]="s.id">
                        <ng-container *ngIf="s.name !== ''">
                            {{ s.name }}
                        </ng-container>
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="theme-select m-r-10 d-flex m-t-20 input-height-46" [style.width.px]="250">
                <mat-label>{{ 'labels.selectDate' | translate }}</mat-label>
                <mat-date-range-input [rangePicker]="picker">
                    <input matStartDate placeholder="{{ 'labels.startDate' | translate }}" readonly [(ngModel)]="startDate" />
                    <input matEndDate placeholder="{{ 'labels.endDate' | translate }}" readonly [(ngModel)]="endDate" />
                </mat-date-range-input>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
            <mat-form-field class="theme-select m-r-10 m-t-20 input-height-46" appearance="outline"[style.width.px]="320">
                <mat-label>{{ 'labels.sortBy' | translate }}</mat-label>
                <mat-icon matPrefix class="m-r-0 p-r-0"><i-tabler name="transfer-vertical" class="icon-20 cursor-pointer"></i-tabler></mat-icon>
                <mat-select [value]="sort"
                            (selectionChange)="onSelectSortChange($event)">
                    <mat-option *ngFor="let item of productSorts" [value]="item">
                        {{ 'admin.shop.product.common.sorts.' + item | translate }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div class="m-r-10 p-t-12 m-t-24" [innerHTML]="'order.search.findCountOrder' | translate: { count: pageLength | number }"></div>
            <button mat-mini-fab color="primary m-t-24" (click)="filter()" class="d-flex">
                <i class="iconify icon-20 d-flex" data-icon="solar:refresh-bold"></i>
            </button>
        </div>

        <mat-divider></mat-divider>
        <div class="table-responsive border rounded-4" (scroll)="onScroll($event)">
            <table mat-table [dataSource]="orders" [trackBy]="trackById" class="w-100 table-striped table-hover table-default table-orders">
                <!-- Weight Column -->
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column sticky-col-1" [ngClass]="{ 'sticky-box-shadow-right': isTableScrolled }">
                        {{ 'labels.id' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 sticky-col-1" [style.width.px]="150" [ngClass]="{ 'sticky-box-shadow-right': isTableScrolled }">
                        <span class="cursor-pointer text-primary text-truncate">
                            <app-order-partial-source-logo [element]="element" (clickDetail)="openDialogDetail(element)"></app-order-partial-source-logo>
                        </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="customerMobile">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'labels.customer.mobile' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1" [style.width.px]="100">
                        <span [className]="element?.data?.bill_phone_number ? 'text-dark-200 cursor-pointer' : 'text-error cursor-pointer'"
                            (click)="openDialogDetail(element)">{{ element?.data?.bill_phone_number ?? 'labels.missPhoneNumber' | translate }}<app-order-partial-vietnam-phone-carrier [phoneNumber]="element?.data?.bill_phone_number"></app-order-partial-vietnam-phone-carrier></span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="customerName">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'labels.customer.name' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1" [style.width.px]="220">
                        <span class="text-dark-200 cursor-pointer" (click)="openDialogDetail(element)">{{ element?.data?.customer?.username ?? element?.data?.customer?.name ?? 'N/A' }}</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="product">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'labels.product' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-truncate text-dark-200" [style.width.px]="350">
                        <span class="text-error" *ngIf="!element.countProduct()">{{ 'order.common.noProduct' | translate }}</span>
                        <span (click)="openDialogDetail(element)" class="text-primary cursor-pointer" *ngIf="element.hasManyProduct()">{{ 'order.common.hasManyProduct' | translate }} ({{ element.countProduct() }})</span>

                        <div (click)="openDialogDetail(element)" *ngIf="element.countProduct() === 1" class="text-truncate cursor-pointer" style="max-width: 350px"
                             matTooltip="{{ element.getProducts()[0]?.name }} {{ element.getProducts()[0]?.variation }} x {{ element.getProducts()[0]?.quantity }}"
                             matTooltipPosition="right">
                            {{ element.getProducts()[0]?.name }} {{ element.getProducts()[0]?.variation }} x {{ element.getProducts()[0]?.quantity }}
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="note">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'labels.note' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-truncate text-wrap" [style.width.px]="350">
                        <div class="text-truncate text-dark-200" style="max-width: 350px">
                            {{ element?.data?.note ?? 'N/A' }}
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="customerAddress">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'labels.customer.address' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1" [style.width.px]="350">
                        <div class="text-truncate text-dark-200" style="max-width: 350px">
                            {{ element?.data?.customer?.shop_customer_addresses[0]?.full_address ?? 'N/A' }}
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="shipping">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'labels.customer.shipping' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1" [style.width.px]="350">
                        <div class="text-dark-200 f-w-500" *ngIf="element?.shipping_info?.name">
                            {{ element.shipping_info.name }}
                        </div>
                        <div class="text-dark-200" *ngIf="element?.shipping_info?.trackingNumber">
                            <span class="m-l-5 text-dark-200">{{ element.shipping_info.trackingNumber }} <i-tabler (click)="copy(element.shipping_info.trackingNumber)" name="copy" class="icon-12 cursor-pointer"></i-tabler></span>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="totalAmount">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        {{ 'labels.totalAmount' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-wrap text-dark-200" [style.width.px]="50">
                        {{ element?.data?.money_to_collect | number }} ₫
<!--                        {{ element?.data?.money_to_collect  | currency:'VND':'symbol':'1.0-0':'vi-VN' }} ₫-->
                    </td>
                </ng-container>

                <ng-container matColumnDef="insertedAt">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        {{ 'labels.insertedAt' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-wrap text-dark-200" [style.width.px]="50">
                        {{ element?.inserted_at | date: 'HH:mm dd/MM/YYYY' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="updatedAt">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        {{ 'labels.updatedAt' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-wrap text-dark-200" [style.width.px]="50">
                        {{ element?.updated_at | date: 'HH:mm dd/MM/YYYY' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-center sticky-right sticky-box-shadow-left">
                        {{ 'warehouse.common.status' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-center sticky-right sticky-box-shadow-left" [style.width.px]="150">
                        <app-order-partial-status [element]="element"></app-order-partial-status>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-dark"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
        </div>
        <div class="text-center p-t-20 p-b-20" *ngIf="orders.length == 0">
            <div class="text-muted">{{ 'common.noData' | translate }}</div>
        </div>
        <mat-divider class="m-b-10"></mat-divider>
        <mat-paginator
                [length]="pageLength"
                [pageIndex]="pageIndex"
                [pageSize]="pageSize"
                [pageSizeOptions]="pageSizeOptions"
                (page)="onPageChange($event)"
                aria-label="Select page"></mat-paginator>
    </mat-card-content>
</ng-template>

