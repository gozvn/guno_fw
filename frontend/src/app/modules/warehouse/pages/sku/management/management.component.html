<div class="bg-white rounded p-20 m-b-20">
    <div class="row">
        <div class="col-sm-8">
            <h4 class="page-title m-0 f-s-18 f-w-600">
                {{ 'warehouse.sku.management.title' | translate }}
            </h4>
        </div>
        <div class="col-sm-4 text-right">
            <div class="d-flex align-items-center justify-content-start justify-content-lg-end">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a class="text-body-color" [routerLink]="['/']">{{ 'labels.dashboard' | translate }}</a></li>
                    <li class="breadcrumb-item">
                        <i-tabler name="circle-filled" class="icon-8"></i-tabler>
                    </li>
                    <li class="breadcrumb-item"><a class="text-body-color" [routerLink]="['/', 'admin']">{{ 'labels.warehouse' | translate }}</a></li>
                    <li class="breadcrumb-item">
                        <i-tabler name="circle-filled" class="icon-8"></i-tabler>
                    </li>
                    <li class="breadcrumb-item active">
                        <span class="rounded-sm p-x-8 p-y-4 text-primary bg-light-primary f-s-12 f-w-500">
                            {{ 'warehouse.sku.common.title' | translate }}
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<mat-card class="cardWithShadow widget-container">
    <mat-card-content class="p-0 p-b-10">
        <div class="p-t-0 p-b-10 d-lg-flex">
            <mat-form-field class="theme-select m-l-10 m-r-10 d-flex m-t-20 input-height-46" appearance="outline" [style.width.px]="160">
                <mat-label>{{ 'labels.autoRefresh' | translate }}</mat-label>
                <mat-icon matPrefix class="m-r-0 p-r-0"><i-tabler name="refresh" class="icon-20 cursor-pointer"></i-tabler></mat-icon>
                <mat-select [value]="presetAutoRefresh" (selectionChange)="onSelectPresetAutoRefreshChange($event)">
                    <mat-option *ngFor="let preset of presetAutoRefreshs" [value]="preset">
                        <ng-container *ngIf="preset !== 'customize'">
                            {{ 'labels.autoRefresh' + preset | translate }}
                        </ng-container>
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field [style.width.px]="200" class="theme-select m-r-10 d-flex m-t-20 input-height-46" appearance="outline">
                <mat-label>{{ 'labels.keyword' | translate }}</mat-label>
                <input type="text"
                       placeholder="{{ 'labels.keywordPlaceholder' | translate }}"
                       matInput
                       (keyup.enter)="onInputSellerSkuEnter($event)"
                       [(ngModel)]="keyword" />
            </mat-form-field>
            <mat-form-field class="theme-select m-r-10 m-t-20 input-height-46" appearance="outline"[style.width.px]="320">
                <mat-label>{{ 'labels.sortBy' | translate }}</mat-label>
                <mat-icon matPrefix class="m-r-0 p-r-0"><i-tabler name="transfer-vertical" class="icon-20 cursor-pointer"></i-tabler></mat-icon>
                <mat-select [value]="sort"
                            (selectionChange)="onSelectSortChange($event)">
                    <mat-option *ngFor="let item of skuSorts" [value]="item">
                        {{ 'warehouse.common.sku.sorts.' + item | translate }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div class="m-r-10 p-t-12 m-t-24" [innerHTML]="'admin.shop.product.search.findCountProduct' | translate: { count: pageLength | number }"></div>
            <button mat-mini-fab color="primary m-t-24" (click)="search()" class="d-flex">
                <i class="iconify icon-20 d-flex" data-icon="solar:refresh-bold"></i>
            </button>

            <button mat-flat-button (click)="exportExcel($event)" color="primary m-t-24 m-l-auto m-r-10 d-flex align-content-center justify-content-center btn-icon-button">
                <i class="iconify icon-20" data-icon="solar:file-download-broken"></i>
                {{ 'buttons.exportExcel' | translate }}
            </button>
        </div>

        <mat-divider></mat-divider>
        <div class="table-responsive border rounded-4" (scroll)="onScroll($event)">
            <table mat-table [dataSource]="products" [trackBy]="trackById" class="w-100 table-default table-skus table-custom-small">
                <!-- Weight Column -->
                <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column sticky-col-1" [ngClass]="{ 'sticky-box-shadow-right': isTableScrolled }">
                        {{ 'warehouse.inventory.common.sellerSku' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 sticky-col-1" [ngClass]="{ 'sticky-box-shadow-right': isTableScrolled }">
                        <div class="d-flex align-items-center gap-6">
                            <img alt="{{ element.seller_sku }}" width="48" class="rounded cursor-pointer product-image"
                                 appLazyLoadImage="{{ element?.images[0] }}" (error)="onImageError($event)" (click)="openLightBox(element.code, element?.images[0])" />
                            <div>
                                <h5 class="f-s-15 f-w-700 m-t-4 m-b-0">{{ element.code }}</h5>
                                <div class="m-t-3"><i-tabler name="hash" class="icon-12 cursor-pointer"></i-tabler>
                                    <span *ngFor="let field of element.fields">
                                        <span>{{ field.name }}</span>: <span class="f-w-900">{{ field.value }}</span>,
                                    </span>
                                </div>
                                <div class="m-t-3"><i-tabler name="calendar" class="icon-12 cursor-pointer"></i-tabler> {{ element.updatedAt | date: 'dd/MM/YYYY, HH:mm:ss' }}</div>
                            </div>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="sellerProduct">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column">
                        {{ 'warehouse.inventory.common.sellerProduct' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-dark-200" [style.width.px]="150">
                        {{ element?.product?.code }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="costPrice">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:dollar-linear" class="iconify f-s-16"></i> {{ 'warehouse.common.costPrice' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right" [style.width.px]="150">
                        <mat-form-field [style.width.px]="100" class="input-height-46" appearance="outline">
                            <input matInput [type]="'text'" (change)="onChangeCostPrice($event, element)" [ngModel]="element?.costPrice | number" (keyup)="onKeyupCostPrice($event, element)" />
                        </mat-form-field> â‚«
                    </td>
                </ng-container>

                <ng-container matColumnDef="totalQuantity">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        {{ 'warehouse.common.totalQuantity' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.totalQuantity | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="onHandLogic">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:shop-minimalistic-line-duotone" class="iconify f-s-16"></i> {{ 'warehouse.common.onHandLogic' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right" [style.width.px]="150">
                        <span class="hover-text cursor-pointer text-primary"
                              *ngIf="editSellerSku !== element.code"
                              (click)="editValue(element.name, element, typeObjects.onHand)" (focus)="editValue(element.onHand, element, typeObjects.onHand);"
                              matTooltip="{{ 'buttons.clickToEdit' | translate }}"
                              matTooltipPosition="above">{{ element.onHand | number }}
                        </span>
                        <div *ngIf="editSellerSku === element.code">
                            <mat-form-field style="width: 220px" class="theme-select input-height-40" appearance="outline">
                                <input matInput #inlineEditControlName (keypress)="onKeyPressInput($event, element, typeObjects.onHand)" [required]="required" [value]="element.onHandDb" [type]="'number'" placeholder="{{ 'warehouse.sku.common.inputOnHandValue' | translate }}" />
                                <button mat-flat-button matSuffix class="bg-error text-white btn-width-40 btn-height-40 r-r-0 r-l-0 cancel-action-btn"
                                        (click)="editSellerSku = ''">
                                    <i-tabler name="x"></i-tabler>
                                </button>
                                <button mat-flat-button matSuffix class="bg-success text-white btn-height-40 r-l-0"
                                        [disabled]="!inlineEditControlName.value"
                                        (click)="saveValue(element, typeObjects.onHand)">
                                    <i-tabler name="check"></i-tabler>
                                </button>
                            </mat-form-field>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="pancakeActualRemainQuantity">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 text-primary f-s-14 fixed-width-column text-right">
                        {{ 'warehouse.common.pancakeActualRemainQuantity' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right" [style.width.px]="150" [ngClass]="{ 'text-error': element.pancakeActualRemainQuantity > 0 && element.onHand != element.pancakeActualRemainQuantity }">
                        {{ element.pancakeActualRemainQuantity | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="sellableQuantity">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                       <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:sort-vertical-outline" class="iconify f-s-18"></i> {{ 'warehouse.common.sellableQuantity' | translate }}
                       </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.sellableQuantity | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="pancakeRemainQuantity">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 text-primary f-s-14 fixed-width-column text-right">
                        {{ 'warehouse.common.pancakeRemainQuantity' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right" [style.width.px]="150" [ngClass]="{ 'text-error': element.pancakeRemainQuantity > 0 && element.sellableQuantity != element.pancakeRemainQuantity }">
                        {{ element.pancakeRemainQuantity | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="reserved">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:lock-password-linear" class="iconify f-s-18"></i> {{ 'warehouse.common.reserved' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.reserved | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="onShipping">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:bus-bold" class="iconify f-s-18"></i> {{ 'warehouse.common.onShipping' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.onShipping | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="received">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:user-check-bold" class="iconify f-s-18"></i> {{ 'warehouse.common.received' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.received | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="returning">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:recive-twice-square-linear" class="iconify f-s-18"></i> {{ 'warehouse.common.returning' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.returning | number }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="returned">
                    <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14 fixed-width-column text-right">
                        <span class="d-inline-flex align-items-center gap-4">
                            <i data-icon="solar:undo-left-round-square-bold" class="iconify f-s-18"></i> {{ 'warehouse.common.returned' | translate }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element" class="mat-body-1 text-right text-dark-200" [style.width.px]="150">
                        {{ element.returned | number }}
                    </td>
                </ng-container>


                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
        </div>
        <div class="text-center p-t-20 p-b-20" *ngIf="products.length == 0">
            <div class="text-muted">{{ 'common.noData' | translate }}</div>
        </div>
        <mat-divider class="m-b-10"></mat-divider>
        <mat-paginator
                [length]="pageLength"
                [pageIndex]="pageIndex"
                [pageSize]="pageSize"
                [pageSizeOptions]="pageSizeOptions"
                (page)="onPageChange($event)"
                aria-label="Select page"></mat-paginator>
    </mat-card-content>

</mat-card>
