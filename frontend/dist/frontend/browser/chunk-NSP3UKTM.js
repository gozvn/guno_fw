import{b as ct}from"./chunk-HDVTBRPG.js";import{a as nt}from"./chunk-EMKKK2TE.js";import{a as at}from"./chunk-AYNFE6FB.js";import{a as dt}from"./chunk-6AMBXUQL.js";import{b as it}from"./chunk-HW6NCLFS.js";import{b as K}from"./chunk-VD7526WH.js";import{a as st}from"./chunk-ASVI2MGW.js";import{r as et,s as rt,t as ot}from"./chunk-L6F77YVF.js";import{C as L,M as E,Pa as U,T as q,U as G,ba as V,c as T,ca as W,da as z,ea as Q,gb as J,ib as X,jb as Z,kb as $,l as N,lb as tt,q as D}from"./chunk-72SSQTOY.js";import{Ab as B,Hc as I,Ic as R,Ja as x,Ub as h,Vb as l,Wb as S,_ as w,bc as F,f as j,ha as O,ia as d,jd as P,ma as b,mb as y,nb as o,qc as g,rc as C,sa as Y,ta as p,u as k,wd as _,xd as H}from"./chunk-7KMJWKAM.js";import{g as lt}from"./chunk-WWX6BADO.js";var A=lt(dt());var f=class r{constructor(n,t){this.http=n;this.backendService=t}apiServerPaths=tt.backendServer.paths;dataBigIdea=new j;overview(n){}static \u0275fac=function(t){return new(t||r)(b(T),b(et))};static \u0275prov=O({token:r,factory:r.\u0275fac,providedIn:"root"})};var u=class r extends ot{constructor(t,e,i,c,m,a,ft,ut,vt){super(t,e,i,c);this.activeRoute=t;this.translateService=e;this.authenticationService=i;this.injector=c;this.sidenavService=m;this.location=a;this.clipboard=ft;this.snackBar=ut;this.statsDashboardService=vt;this.activeRoute.queryParams.subscribe(s=>{this.creator=s.creator??null,this.creatorControl.setValue(s.creator||""),this.shopId=s["shop-id"]??this.shopId,this.presetAutoRefresh=s.refresh??"not-set"}),this.creatorFilteredOptions=this.creatorControl.valueChanges.pipe(w(""),k(s=>this._filterCreator(s||"")))}stats=[];statsYesterday=[];statsItems=[];creator=null;totalOrders=0;totalAmount=0;totalRevenue=0;totalOrdersYesterday=0;totalAmountYesterday=0;totalRevenueYesterday=0;creators=[];creatorControl=new E("");creatorSubscription;creatorSelected;creatorFilter;creatorFilteredOptions;shopId="-1";shops=[];presetDates=["today","yesterday","last7days","last28days","this_week","this_month","customize"];presetAutoRefresh="not-set";presetAutoRefreshs=["not-set","5s","10s","20s"];reload=!1;ngOnInit(){super.ngOnInit(),this.getCreators(),this.autoRefresh()}ngOnDestroy(){super.ngOnDestroy(),this._intervalAutoRefresh&&clearInterval(this._intervalAutoRefresh)}_filterCreator(t){let e=t.toLowerCase();return this.creators.filter(i=>i.name.toLowerCase().includes(e)||i.username.toLowerCase().includes(e))}getStats(t=!0){let e={loadingState:t,fd:(0,A.default)(this.startDate).format("YYYY-MM-DD"),td:(0,A.default)(this.endDate).format("YYYY-MM-DD")};this.shopId&&this.shopId!=="-1"&&(e["shop-id"]=this.shopId);let i=this.creatorControl.value,c=this.creators.find(a=>a.name===i);this.creator=null,c&&(this.creator=c.username,e.creator=this.creator),this.totalOrders=0,this.totalAmount=0,this.totalRevenue=0,this.totalOrdersYesterday=0,this.totalAmountYesterday=0,this.totalRevenueYesterday=0;let m=["refresh="+this.presetAutoRefresh];for(let a in e)a!=="loadingState"&&m[a]!==""&&m[a]!==null&&m.push(a+"="+e[a]);this.location.replaceState("/dashboard",m.join("&"))}_intervalAutoRefresh=null;autoRefresh(){let t=0;switch(this.presetAutoRefresh){case"5s":t=5;break;case"10s":t=10;break;case"20s":t=20;break}this._intervalAutoRefresh&&clearInterval(this._intervalAutoRefresh),t&&(this._intervalAutoRefresh=setInterval(()=>{this.reload=!0,this.getStats(!1)},t*1e3))}getCreators(){let t={}}onSelectShopChange(t){this.shopId=t.value,this.reload=!0,this.getStats()}onSelectStatusChange(t){this.getStats()}onSelectStartDate(t){this.endDate=t}onSelectPresetAutoRefreshChange(t){this.presetAutoRefresh=t.value,this.autoRefresh()}static \u0275fac=function(e){return new(e||r)(o(N),o(X),o(rt),o(x),o(at),o(P),o(nt),o(U),o(f))};static \u0275cmp=Y({type:r,selectors:[["app-dashboard-page-home"]],features:[B],decls:16,vars:6,consts:[[1,"row"],[1,"col-lg-12"],[1,"cardWithShadow","m-b-20"],[1,"p-b-0"],[1,"hstack","align-items-center","flex-column","flex-lg-row"],[1,"w-100"],[1,"m-l-auto","hstack"],[1,"p-t-20","d-lg-flex"],["mat-flat-button","","color","primary",1,"d-flex","btn-height-48",3,"click"],["data-icon","solar:refresh-bold",1,"iconify","icon-20","d-flex"]],template:function(e,i){e&1&&(h(0,"div",0)(1,"div",1)(2,"mat-card",2)(3,"mat-card-content",3)(4,"div",4)(5,"div",5)(6,"mat-card-title"),g(7),I(8,"translate"),l(),h(9,"mat-card-subtitle"),g(10),I(11,"translate"),l()(),S(12,"div",6),l(),h(13,"div",7)(14,"button",8),F("click",function(){return i.getStats(),i.reload=!0}),S(15,"i",9),l()()()()()()),e&2&&(y(7),C(R(8,2,"dashboard.home.title")),y(3),C(R(11,4,"dashboard.home.description")))},dependencies:[L,V,z,Q,W,Z]})};var ht=[{path:"",component:u,data:{title:"dashboard.home.title"},canActivate:[st]}],v=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=p({type:r});static \u0275inj=d({imports:[D.forChild(ht),D]})};var mt=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=p({type:r});static \u0275inj=d({providers:[_],imports:[H,q,G,v,J,$,K,it,ct.forRoot()]})};export{mt as DashboardModule};
