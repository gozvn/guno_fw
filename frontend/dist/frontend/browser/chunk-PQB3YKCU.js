import{a as tt}from"./chunk-JSUAOEMS.js";import{a as et}from"./chunk-NQOY33G3.js";import{b as it}from"./chunk-KLVANESB.js";import{d as Je,e as Ke}from"./chunk-YCX5PDJM.js";import{a as Ze}from"./chunk-EMKKK2TE.js";import{a as Qe}from"./chunk-AYNFE6FB.js";import{a as st}from"./chunk-6AMBXUQL.js";import{b as Ue}from"./chunk-HW6NCLFS.js";import{a as ze,b as He}from"./chunk-VD7526WH.js";import{a as Xe}from"./chunk-ASVI2MGW.js";import{a as Ye,r as Ge,s as We,t as qe}from"./chunk-L6F77YVF.js";import{$ as ye,Aa as Ie,B as le,Ba as De,C as ce,Ca as Te,Da as Ee,F as pe,H as me,J as de,N as ue,Na as Re,Pa as Be,Sa as Ae,T as he,U as ge,W as fe,Ya as Le,Z as _e,_a as je,aa as be,c as re,da as ve,gb as Fe,ha as Se,ib as Oe,jb as Ve,kb as Ne,l as oe,lb as $e,o as se,q as O,ua as xe,va as Ce,wa as Pe,xa as Me,ya as we,za as ke}from"./chunk-72SSQTOY.js";import{Ab as U,Ac as X,Bc as B,Da as C,Ea as P,Fb as y,Hc as d,Ic as u,Ja as W,Jc as Z,Kb as m,Lb as S,Ub as s,Vb as l,Wb as g,Xb as M,Yb as w,_b as E,bc as b,dc as f,f as $,gc as R,ha as Y,hb as q,ia as D,jd as ee,ma as H,mb as o,nb as h,nd as te,od as ie,pd as ae,qc as p,rc as x,sa as G,sc as v,ta as T,u as I,vc as J,wc as K,wd as A,xc as Q,xd as ne}from"./chunk-7KMJWKAM.js";import{g as ot}from"./chunk-WWX6BADO.js";var N=ot(st());var L=class{product_id="";shop_id="";display_id="";custom_id="";cost_price=0;data;constructor(r){if(r)for(let e in r)this[e]=r[e]}};var j=class t{constructor(r,e){this.http=r;this.backendService=e}apiServerPaths=$e.backendServer.paths;dataBigIdea=new $;_getModel(r){return new L(r)}getById(r){let e=this.apiServerPaths.gunoHub.order.detail.replace("{ORDER_ID}",r.toString()),a={params:{encryptParam:!0},headers:{Accept:"application/json"}};return this.backendService.get(e,a,I(i=>{let c=i.data?.order??!1;return c?this._getModel(c):!1}))}search(r){let e=this.apiServerPaths.gunoHub.product.search,a={params:{encryptParam:!0},headers:{Accept:"application/json"}};for(let i in r)switch(i){default:a.params[i]=r[i]}return this.backendService.get(e,a,I(i=>{console.log(i);let n=i.data,c=n?.products??[];n.products=[];for(let k in c)n.products.push(this._getModel(c[k]));return i.data=n,i.data}))}updateCostPrice(r,e){let a=this.apiServerPaths.gunoHub.product.update.replace("{TYPE}","cost-price"),i={params:{encryptBody:!0,seller_product:r,value:e},headers:{Accept:"application/json"}};return this.backendService.post(a,i,I(n=>n.data))}static \u0275fac=function(e){return new(e||t)(H(re),H(Ge))};static \u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})};var ct=()=>["/"],pt=t=>({count:t}),at=t=>({"sticky-box-shadow-right":t});function mt(t,r){if(t&1&&(M(0),p(1),d(2,"translate"),w()),t&2){let e=f().$implicit;o(),v(" ",u(2,1,"labels.autoRefresh"+e)," ")}}function dt(t,r){if(t&1&&(s(0,"mat-option",43),y(1,mt,3,3,"ng-container",44),l()),t&2){let e=r.$implicit;m("value",e),o(),m("ngIf",e!=="customize")}}function ut(t,r){if(t&1&&(s(0,"th",45),p(1),d(2,"translate"),l()),t&2){let e=f();m("ngClass",B(4,at,e.isTableScrolled)),o(),v(" ",u(2,2,"labels.id")," ")}}function ht(t,r){if(t&1){let e=E();s(0,"td",46)(1,"a",47),b("click",function(){let i=C(e).$implicit,n=f();return P(n.openDialogDetail(i))}),p(2),l()()}if(t&2){let e=r.$implicit,a=f();S("width",100,"px"),m("ngClass",B(4,at,a.isTableScrolled)),o(2),v(" ",e.custom_id," ")}}function gt(t,r){t&1&&(s(0,"th",48),p(1),d(2,"translate"),l()),t&2&&(o(),v(" ",u(2,1,"warehouse.product.common.name")," "))}function ft(t,r){if(t&1&&(s(0,"span")(1,"span"),p(2),l(),p(3,", "),l()),t&2){let e=r.$implicit;o(2),x(e.name)}}function _t(t,r){if(t&1&&(s(0,"td",49)(1,"div",50)(2,"div")(3,"h5",51),p(4),l(),s(5,"div",52),g(6,"i-tabler",53),y(7,ft,4,1,"span",54),l()()()()),t&2){let e=r.$implicit;S("width",100,"px"),o(4),x(e.data.name),o(3),m("ngForOf",e.data.product_attributes)}}function yt(t,r){t&1&&(s(0,"th",55),p(1),d(2,"translate"),l()),t&2&&(o(),v(" ",u(2,1,"labels.image")," "))}function bt(t,r){if(t&1){let e=E();s(0,"img",58),b("error",function(i){C(e);let n=f(2);return P(n.onImageError(i))})("click",function(){C(e);let i=f().$implicit,n=f();return P(n.openLightBox(i.data.name,i.data.variations[0].images[0]))}),l()}if(t&2){let e=f().$implicit;R("alt",e.seller_sku),R("appLazyLoadImage",e.data.variations[0].images[0])}}function vt(t,r){if(t&1&&(s(0,"td",56),y(1,bt,1,2,"img",57),l()),t&2){let e=r.$implicit;S("width",80,"px"),o(),m("ngIf",e.data.variations[0].images[0])}}function St(t,r){t&1&&(s(0,"th",48),p(1),d(2,"translate"),l()),t&2&&(o(),v(" ",u(2,1,"warehouse.common.costPrice")," "))}function xt(t,r){if(t&1){let e=E();s(0,"td",59)(1,"mat-form-field",60)(2,"input",61),d(3,"number"),b("change",function(i){let n=C(e).$implicit,c=f();return P(c.onChangeCostPrice(i,n))})("keyup",function(i){let n=C(e).$implicit,c=f();return P(c.onChangeCostPrice(i,n))}),l()(),p(4," \u20AB "),s(5,"button",62),b("click",function(i){let n=C(e).$implicit,c=f();return P(c.onSave(i,n))}),p(6),d(7,"translate"),l()()}if(t&2){let e=r.$implicit;S("width",150,"px"),o(),S("width",120,"px"),o(),m("type","text")("ngModel",u(3,7,e==null?null:e.cost_price)),o(4),x(u(7,9,"buttons.save"))}}function Ct(t,r){t&1&&g(0,"tr",63)}function Pt(t,r){t&1&&g(0,"tr",64)}function Mt(t,r){t&1&&(s(0,"div",65)(1,"div",66),p(2),d(3,"translate"),l()()),t&2&&(o(2),x(u(3,1,"common.noData")))}var F=class t extends qe{constructor(e,a,i,n,c,k,kt,It,Dt,Tt,Et){super(e,a,i,n);this.activeRoute=e;this.translateService=a;this.authenticationService=i;this.injector=n;this.sidenavService=c;this.lightbox=k;this.dialog=kt;this.location=It;this.clipboard=Dt;this.snackBar=Tt;this.productService=Et;this.activeRoute.queryParams.subscribe(_=>{this.tab=_.tab??"all",this.selectedTabIndex=this.tabs.findIndex(rt=>rt===this.tab)||0,this.currentPage=_.page??1,this.currentPage=parseInt(this.currentPage.toString()),this.pageIndex=this.currentPage-1,this.sort=_.sort??this.sort,this.keyword=_.keyword??"",this.sku=_.sku??"",this.orderStatus=_.status?_.status.split(",").map(Number):[],this.sort=parseInt(this.sort.toString()),this.presetAutoRefresh=_.refresh??"not-set",this.orderSource=_.source??"not-set"}),this.tabs.forEach(_=>{this.tabsStats[_]=0})}selectedTabIndex=0;tab="all";tabs=["all","ACTIVATE","DELETED"];tabsStats=[];keyword="";sku="";productSorts=[0,1,2,3];sort=1;presetDate="today";presetDates=["today","yesterday","last7days","last28days","this_week","this_month","customize"];presetAutoRefresh="not-set";presetAutoRefreshs=["not-set","5s","10s","20s"];orderSource="not-set";presetOrderSources=["not-set","facebook","tiktok","shopee"];orderStatus=null;orderStatuses=Ye.status.pancake.statusesSorted;stats=[];products=[];shops=[];displayedColumns=["id","name","image","costPrice"];filterCount=0;shopId="-1";dateType="create";type="not-set";isTableScrolled=!1;totalOrders=0;sidenavSubscription=null;ngOnInit(){super.ngOnInit(),this.search(),this.autoRefresh(),this.sidenavSubscription=this.sidenavService.apply$.subscribe(e=>{this.startDate=e?.startDate,this.endDate=e?.endDate,this.shopId=e?.shopId,this.dateType=e?.dateType,this.presetDate=this.presetDates[this.presetDates.length-1],this.pageIndex=0,this.currentPage=1,this.search()})}ngOnDestroy(){super.ngOnDestroy(),this.sidenavSubscription.unsubscribe(),this._intervalAutoRefresh&&clearInterval(this._intervalAutoRefresh)}toggleSidenav(){this.sidenavService.toggle()}_intervalAutoRefresh=null;autoRefresh(){let e=0;switch(this.presetAutoRefresh){case"5s":e=5;break;case"10s":e=10;break;case"20s":e=20;break}this._intervalAutoRefresh&&clearInterval(this._intervalAutoRefresh),e&&(this._intervalAutoRefresh=setInterval(()=>{this.isTabVisible()&&this.search(!1)},e*1e3))}onTabChange(e){if(this.loadingState)return;let a=this.orderStatuses[e.index-1];typeof a<"u"?this.orderStatus=[a.id]:this.orderStatus=[],this.products=[],this.pageIndex=0,this.currentPage=1,this.search()}search(e=!0){this.widgetLoadingState=!0;let a={loadingState:e,tab:this.tab,type:this.type,source:this.orderSource,page:this.currentPage,limit:this.pageSize,fd:(0,N.default)(this.startDate).format("YYYY-MM-DD"),td:(0,N.default)(this.endDate).format("YYYY-MM-DD"),sort:this.sort};this.keyword&&(a.keyword=this.keyword),this.sku&&(a.sku=this.sku),this.orderStatus&&this.orderStatus.length>0&&(this.orderStatus.every(c=>this.orderStatuses.some(k=>k.id===c))?a.status=this.orderStatus.join(","):this.orderStatus=[]),this.productService.search(a).subscribe(n=>{this.products=n?.products??[],this.pageLength=n.count});let i=["refresh="+this.presetAutoRefresh];for(let n in a)n!=="loadingState"&&i[n]!==""&&i[n]!==null&&i.push(n+"="+a[n]);this.location.replaceState("/product/management",i.join("&"))}openSnackBar(e,a){this.snackBar.open(e,a,{horizontalPosition:"end",verticalPosition:"top",duration:4*1e3})}copy(e){this.clipboard.copy(e),this.openSnackBar(this.translateService.instant("labels.copySuccess")+` ${e}`,"")}onPageChange(e){this.loadingState||this.pageSize===e.pageSize&&this.pageIndex===e.pageIndex||(this.pageIndex=e.pageIndex,this.currentPage=e.pageIndex+1,this.pageSize=e.pageSize,this.search())}onSelectPresetAutoRefreshChange(e){this.presetAutoRefresh=e.value,this.autoRefresh()}onSelectPresetOrderSourceChange(e){this.orderSource=e.value,this.search()}onOrderStatusChange(e){let a=e.value;this.orderStatus=a}onSelectSortChange(e){this.sort=e.value,this.search()}trackById(e,a){return a.order_id}openDialogDetail(e){}openDialogCreateDelivery(){}onInputOrderEnter(e){let a=e.target.value;this.keyword=a,this.pageIndex=0,this.currentPage=1,this.search()}onScroll(e){let a=e.target;this.isTableScrolled=a.scrollLeft>0}openLightBox(e,a){if(!a)return;let i=[{caption:e,src:a}];this.lightbox.open(i,0)}onChangeCostPrice(e,a){let n=e.target.value.replace(/\D/g,"");a.cost_price=parseInt(n),e?.key==="Enter"&&a.cost_price>=0&&this.onSave(e,a)}onSave(e,a){this.productService.updateCostPrice(a.custom_id,a.cost_price).subscribe(i=>{this.openSnackBar(this.translateService.instant("labels.updateSuccess"),"")})}static \u0275fac=function(a){return new(a||t)(h(oe),h(Oe),h(We),h(W),h(Qe),h(Je),h(Ae),h(ee),h(Ze),h(Be),h(j))};static \u0275cmp=G({type:t,selectors:[["app-product-page-management"]],features:[U],decls:63,vars:44,consts:[[1,"bg-white","rounded","p-20","m-b-20"],[1,"row"],[1,"col-sm-8"],["data-bs-toggle","tooltip","data-bs-html","true","title","<strong>Hello</strong>, <em>world!</em>",1,"page-title","m-0","f-s-18","f-w-600"],[1,"col-sm-4","text-right"],[1,"d-flex","align-items-center","justify-content-start","justify-content-lg-end"],[1,"breadcrumb"],[1,"breadcrumb-item"],[1,"text-body-color",3,"routerLink"],["name","circle-filled",1,"icon-8"],[1,"breadcrumb-item","active"],[1,"rounded-sm","p-x-8","p-y-4","text-primary","bg-light-primary","f-s-12","f-w-500"],[1,"p-0","p-b-10"],[1,"p-t-0","p-b-20","p-r-10","p-l-10","d-lg-flex"],["mat-mini-fab","","color","primary m-t-24 m-r-10",1,"d-flex",3,"click"],["data-icon","solar:widget-add-linear",1,"iconify","icon-20","d-flex"],["appearance","outline",1,"theme-select","m-r-10","d-flex","m-t-20","input-height-46"],["matPrefix","",1,"m-r-0","p-r-0"],["name","refresh",1,"icon-20","cursor-pointer"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","",3,"keyup.enter","ngModelChange","placeholder","ngModel"],[1,"m-r-10","p-t-12","m-t-24",3,"innerHTML"],["mat-mini-fab","","color","primary m-t-24",1,"d-flex",3,"click"],["data-icon","solar:refresh-bold",1,"iconify","icon-20","d-flex"],[1,"table-responsive","border","rounded-4",3,"scroll"],["mat-table","",1,"w-100","table-striped","table-hover","table-default","table-orders",3,"dataSource","trackBy"],["matColumnDef","id"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14 fixed-width-column sticky-col-1",3,"ngClass",4,"matHeaderCellDef"],["mat-cell","","class","mat-body-1 sticky-col-1",3,"width","ngClass",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14 fixed-width-column",4,"matHeaderCellDef"],["mat-cell","","class","mat-body-1 text-dark-200",3,"width",4,"matCellDef"],["matColumnDef","image"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14",4,"matHeaderCellDef"],["mat-cell","","class","mat-body-1 fixed-width-column",3,"width",4,"matCellDef"],["matColumnDef","costPrice"],["mat-cell","","class","mat-body-1",3,"width",4,"matCellDef"],["mat-header-row","","class","table-dark",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","text-center p-t-20 p-b-20",4,"ngIf"],[1,"m-b-10"],["aria-label","Select page",3,"page","length","pageIndex","pageSize","pageSizeOptions"],[3,"value"],[4,"ngIf"],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14","fixed-width-column","sticky-col-1",3,"ngClass"],["mat-cell","",1,"mat-body-1","sticky-col-1",3,"ngClass"],[1,"cursor-pointer","text-primary","text-truncate",2,"max-width","50px",3,"click"],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14","fixed-width-column"],["mat-cell","",1,"mat-body-1","text-dark-200"],[1,"d-flex","align-items-center","gap-6"],[1,"f-s-15","f-w-700","m-t-4","m-b-0"],[1,"m-t-3"],["name","hash",1,"icon-12","cursor-pointer"],[4,"ngFor","ngForOf"],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14"],["mat-cell","",1,"mat-body-1","fixed-width-column"],["width","48","class","rounded cursor-pointer product-image",3,"alt","appLazyLoadImage","error","click",4,"ngIf"],["width","48",1,"rounded","cursor-pointer","product-image",3,"error","click","alt","appLazyLoadImage"],["mat-cell","",1,"mat-body-1"],["appearance","outline",1,"input-height-46"],["matInput","",3,"change","keyup","type","ngModel"],["mat-flat-button","","color","primary",1,"m-l-10",3,"click"],["mat-header-row","",1,"table-dark"],["mat-row",""],[1,"text-center","p-t-20","p-b-20"],[1,"text-muted"]],template:function(a,i){a&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),p(4),d(5,"translate"),l()(),s(6,"div",4)(7,"div",5)(8,"ul",6)(9,"li",7)(10,"a",8),p(11),d(12,"translate"),l()(),s(13,"li",7),g(14,"i-tabler",9),l(),s(15,"li",10)(16,"span",11),p(17),d(18,"translate"),l()()()()()()(),s(19,"mat-card-content",12),g(20,"mat-divider"),s(21,"div",13)(22,"button",14),b("click",function(){return i.openDialogCreateDelivery()}),g(23,"i",15),l(),s(24,"mat-form-field",16)(25,"mat-label"),p(26),d(27,"translate"),l(),s(28,"mat-icon",17),g(29,"i-tabler",18),l(),s(30,"mat-select",19),b("selectionChange",function(c){return i.onSelectPresetAutoRefreshChange(c)}),y(31,dt,2,2,"mat-option",20),l()(),s(32,"mat-form-field",16)(33,"mat-label"),p(34),d(35,"translate"),l(),s(36,"input",21),d(37,"translate"),b("keyup.enter",function(c){return i.onInputOrderEnter(c)}),Q("ngModelChange",function(c){return K(i.keyword,c)||(i.keyword=c),c}),l()(),g(38,"div",22),d(39,"number"),d(40,"translate"),s(41,"button",23),b("click",function(){return i.search()}),g(42,"i",24),l()(),g(43,"mat-divider"),s(44,"div",25),b("scroll",function(c){return i.onScroll(c)}),s(45,"table",26),M(46,27),y(47,ut,3,6,"th",28)(48,ht,3,6,"td",29),w(),M(49,30),y(50,gt,3,3,"th",31)(51,_t,8,4,"td",32),w(),M(52,33),y(53,yt,3,3,"th",34)(54,vt,2,3,"td",35),w(),M(55,36),y(56,St,3,3,"th",31)(57,xt,8,11,"td",37),w(),y(58,Ct,1,0,"tr",38)(59,Pt,1,0,"tr",39),l()(),y(60,Mt,4,3,"div",40),g(61,"mat-divider",41),s(62,"mat-paginator",42),b("page",function(c){return i.onPageChange(c)}),l()()),a&2&&(o(4),v(" ",u(5,24,"warehouse.product.common.title")," "),o(6),m("routerLink",X(41,ct)),o(),x(u(12,26,"labels.dashboard")),o(6),v(" ",u(18,28,"warehouse.product.search.title")," "),o(7),S("width",160,"px"),o(2),x(u(27,30,"labels.autoRefresh")),o(4),m("value",i.presetAutoRefresh),o(),m("ngForOf",i.presetAutoRefreshs),o(),S("width",200,"px"),o(2),x(u(35,32,"warehouse.common.keyword")),o(2),R("placeholder",u(37,34,"warehouse.common.keywordPlaceholder")),J("ngModel",i.keyword),o(2),m("innerHTML",Z(40,38,"warehouse.product.search.findCount",B(42,pt,u(39,36,i.pageLength))),q),o(7),m("dataSource",i.products)("trackBy",i.trackById),o(13),m("matHeaderRowDef",i.displayedColumns),o(),m("matRowDefColumns",i.displayedColumns),o(),m("ngIf",i.products.length==0),o(2),m("length",i.pageLength)("pageIndex",i.pageIndex)("pageSize",i.pageSize)("pageSizeOptions",i.pageSizeOptions))},dependencies:[te,ie,ae,me,de,ue,se,ce,pe,be,ye,fe,_e,Se,ve,xe,Pe,Ie,Me,Ce,De,we,ke,Te,Ee,Re,le,Le,je,tt,ze,A,Ve],styles:['@charset "UTF-8";  .order-tab-statues .mat-mdc-tab-labels{padding:10px 0!important}  .order-tab-statues .mdc-tab .mdc-tab__text-label{font-weight:400}  .order-tab-statues .mdc-tab.mdc-tab--active .mdc-tab__text-label{font-weight:600}  .order-tab-statues .mdc-tab.mdc-tab--active .mdc-tab__text-label .badge-custom-dark{color:#fff!important}  .table-orders thead tr{line-height:20px!important;height:40px!important}  .table-orders .sticky-col-1{position:sticky;left:0;z-index:6000}  .table-orders .sticky-col-2{position:sticky;left:187px;z-index:6000}  .table-orders .sticky-right{position:sticky;right:0;z-index:6000}  .table-orders .sticky-box-shadow-right{box-shadow:8px 0 20px -4px #00000026}  .table-orders .sticky-box-shadow-left{box-shadow:-8px 0 20px -4px #00000026}  .table-orders thead th{position:sticky;top:0;background:#f8f9fa;z-index:2000}']})};var wt=[{path:"management",component:F,data:{title:"warehouse.product.search.title"},canActivate:[Xe,et]}],z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=T({type:t});static \u0275inj=D({imports:[O.forChild(wt),O]})};var nt=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=T({type:t});static \u0275inj=D({providers:[A],imports:[ne,he,ge,z,Fe,Ke,it.forChild(),Ne,He,Ue]})};export{nt as ProductModule};
